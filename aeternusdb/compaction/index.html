<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Compaction Module"><title>aeternusdb::compaction - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-ca0dd0c4.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="aeternusdb" data-themes="" data-resource-suffix="" data-rustdoc-version="1.93.1 (01f6ddf75 2026-02-11)" data-channel="1.93.1" data-search-js="search-9e2438ea.js" data-stringdex-js="stringdex-a3946164.js" data-settings-js="settings-c38705f0.js" ><script src="../../static.files/storage-e2aeef58.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-a410ff4d.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module compaction</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../aeternusdb/index.html">aeternusdb</a><span class="version">1.0.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module compaction</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#compaction-module" title="Compaction Module">Compaction Module</a><ul><li><a href="#minor-compaction-size-tiered" title="Minor Compaction (Size-Tiered)">Minor Compaction (Size-Tiered)</a></li><li><a href="#tombstone-compaction-per-sstable-gc" title="Tombstone Compaction (Per-SSTable GC)">Tombstone Compaction (Per-SSTable GC)</a></li><li><a href="#major-compaction-full-merge" title="Major Compaction (Full Merge)">Major Compaction (Full Merge)</a></li><li><a href="#code-organization" title="Code organization">Code organization</a></li></ul></li></ul><h3><a href="#reexports">Module Items</a></h3><ul class="block"><li><a href="#reexports" title="Re-exports">Re-exports</a></li><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#traits" title="Traits">Traits</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate aeternusdb</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">aeternusdb</a></div><h1>Module <span>compaction</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/aeternusdb/compaction/mod.rs.html#1-362">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="compaction-module"><a class="doc-anchor" href="#compaction-module">Â§</a>Compaction Module</h2>
<p>Implements three compaction strategies for the LSM storage engine:</p>
<h3 id="minor-compaction-size-tiered"><a class="doc-anchor" href="#minor-compaction-size-tiered">Â§</a>Minor Compaction (Size-Tiered)</h3>
<p>Groups SSTables into <strong>size buckets</strong> and merges similarly-sized tables
when a bucket exceeds <code>min_threshold</code> entries. Deduplicates point entries
(keeps highest LSN per key) but <strong>preserves all tombstones</strong> â€” both point
and range â€” because other SSTables outside the merge set may still hold
covered data.</p>
<h3 id="tombstone-compaction-per-sstable-gc"><a class="doc-anchor" href="#tombstone-compaction-per-sstable-gc">Â§</a>Tombstone Compaction (Per-SSTable GC)</h3>
<p>Rewrites a single SSTable to remove <strong>point tombstones</strong> that are provably
unnecessary. Uses bloom filters on other SSTables to determine safety:</p>
<ul>
<li>If no other SSTableâ€™s bloom says â€œmaybeâ€ for the key â†’ drop the tombstone.</li>
<li>If bloom says â€œmaybeâ€ and <code>tombstone_bloom_fallback = true</code> â†’ do actual <code>get()</code>
to resolve false positives.</li>
<li>If <code>tombstone_range_drop = true</code> â†’ scan older SSTables to check
whether a range tombstone still covers any live keys.</li>
</ul>
<h3 id="major-compaction-full-merge"><a class="doc-anchor" href="#major-compaction-full-merge">Â§</a>Major Compaction (Full Merge)</h3>
<p>User-triggered via <code>Engine::major_compact()</code>. Merges <strong>all</strong> SSTables into
one, applying range tombstones actively to suppress covered point entries.
All spent tombstones (both point and range) are dropped from the output
since the entire SSTable set is merged â€” no data can resurrect.</p>
<h3 id="code-organization"><a class="doc-anchor" href="#code-organization">Â§</a>Code organization</h3>
<p>The module separates strategy-specific logic (bucketing, selection) from
shared execution primitives (merge, dedup, build). This allows future
strategies (e.g., leveled compaction) to reuse the merge/build plumbing.</p>
</div></details><h2 id="reexports" class="section-header">Re-exports<a href="#reexports" class="anchor">Â§</a></h2><dl class="item-table reexports"><dt id="reexport.MergeIterator"><code>pub use crate::engine::utils::<a class="struct" href="../engine/utils/struct.MergeIterator.html" title="struct aeternusdb::engine::utils::MergeIterator">MergeIterator</a>;</code></dt></dl><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="mod" href="stcs/index.html" title="mod aeternusdb::compaction::stcs">stcs</a></dt><dd>Size-Tiered Compaction Strategy (STCS)</dd></dl><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.CompactionResult.html" title="struct aeternusdb::compaction::CompactionResult">Compaction<wbr>Result</a></dt><dd>Result of a compaction execution â€” enough information to update the
manifest and in-memory SSTable list.</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.CompactionError.html" title="enum aeternusdb::compaction::CompactionError">Compaction<wbr>Error</a></dt><dd>Unified error type for all compaction strategies.</dd><dt><a class="enum" href="enum.CompactionStrategyType.html" title="enum aeternusdb::compaction::CompactionStrategyType">Compaction<wbr>Strategy<wbr>Type</a></dt><dd>Selects which compaction strategy family the engine should use.</dd></dl><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="trait" href="trait.CompactionStrategy.html" title="trait aeternusdb::compaction::CompactionStrategy">Compaction<wbr>Strategy</a></dt><dd>A uniform interface for compaction strategies.</dd></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="fn" href="fn.dedup_records.html" title="fn aeternusdb::compaction::dedup_records">dedup_<wbr>records</a></dt><dd>Deduplicates a merge iterator stream into separate point entries
and range tombstones.</dd><dt><a class="fn" href="fn.finalize_compaction.html" title="fn aeternusdb::compaction::finalize_compaction">finalize_<wbr>compaction</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd>Builds a new SSTable from the given entries, atomically updates the
manifest, and deletes old SSTable files.</dd><dt><a class="fn" href="fn.full_range_scan_iters.html" title="fn aeternusdb::compaction::full_range_scan_iters">full_<wbr>range_<wbr>scan_<wbr>iters</a></dt><dd>Creates scan iterators for the given SSTables covering their full key range.</dd></dl></section></div></main></body></html>